pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
area_templates = {
   l=   {1,1,1,1,0,0,0,1,0,0,0,1,1,1,1,1},
   t=   {1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1},
   r=   {1,1,1,1,1,0,0,0,1,0,0,0,1,1,1,1},
   b=   {1,1,1,1,1,0,0,1,1,0,0,1,1,0,0,1},
   lt=  {0,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1},
   tr=  {1,0,0,0,1,0,0,0,1,0,0,0,1,1,1,1},
   lb=  {1,1,1,1,0,0,0,1,0,0,0,1,0,0,0,1},
   rb=  {1,1,1,1,1,0,0,0,1,0,0,0,1,0,0,0},
   tb=  {1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1},
   ltr= {0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1},
   lrb= {1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0},
   ltb= {0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1},
   trb= {1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0} 
}


draw_area = function(xs, ys, template)
   local sprite = 3 --filler
   local x = xs
   local y = ys

   for i = 1, 16 do

      if template != "F" then
	 sprite = area_templates[template][i]
      end
      
      spr(sprite,x,y,0.5,0.5)

      if i % 4 == 0 then
	 x = xs
	 y+=4
      else
	 x+=4
      end
   end 
     
end

pick_area_template = function(area_number, layout)
   
   local all_neighbours = {
      {0,0,2,5},
      {1,0,3,6},
      {2,0,4,7},
      {3,0,0,8},
      {0,1,6,9},
      {5,2,7,10},
      {6,3,8,11},
      {7,4,0,12},
      {0,5,10,13},
      {9,6,11,14},
      {10,7,12,15},
      {11,8,0,16},
      {0,9,14,0},
      {13,10,15,0},
      {14,11,16,0},
      {15,12,0,0}
   }

   local area_type = layout[area_number]
   local neighbours = all_neighbours[area_number]
   
   local area_template = ""
   if area_type == "F" then return "F" end

   if area_type == "C" or area_type == "S" or area_type == "E" then
      
      if (layout[neighbours[1]]== "C") then area_template = area_template.."l" end
      if (layout[neighbours[2]] == "C") then area_template = area_template.."t" end
      if (layout[neighbours[3]] == "C") then area_template = area_template.."r" end
      if (layout[neighbours[4]] == "C") then area_template = area_template.."b" end
   end
   if (area_template == "") then
      print(area_number.." "..area_type.." "..area_template,0,area_number)
   end
   return area_template
end



function _draw()
   cls()
   --map(0,0,0,0,16,16)

   local layout = {
      "S","C","F","F",
      "F","C","C","F",
      "F","F","C","E",
      "F","F","F","F"
   }
   
   local x=0
   local y=0
   for i = 1,16 do
      local area_template = pick_area_template(i, layout)
      if (area_template != "ltrb") then
	 draw_area(x, y, area_template)
      end
      
      if (i % 4 == 0) then
	 x = 0
	 y +=32
      else
	 x += 32
      end
   end
end





__gfx__
00000000eeeeeeeebbbbbbbb69393936000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeeebbbbbbbb89898986000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700eeeeeeeebbbbbbbb69393936000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eeeeeeeebbbbbbbb61313131000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eeeeeeeebbbbbbbb69393936000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700eeeeeeeebbbbbbbb89898986000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeeebbbbbbbb69393936000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeeeeeeebbbbbbbb61313131000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
